<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placeholder Page</title>
</head>
<body>
    

    <div class="content">
        <h1>Welcome</h1>
        <p>This is a placeholder content. Replace this with your actual content.</p>

        <!-- Chat Widget -->
        <style>
            body {
                margin: 0;
                padding: 0;
                display: flex;
                justify-content: center;
                min-height: 100vh;
                font-family: Arial, sans-serif;
            }
            .content {
                max-width: 800px;
                width: 90%;
                padding: 20px;
                margin: 20px;
                box-shadow: 0 0 10px rgba(0,0,0,0.1);
                border-radius: 5px;
            }
    
            .chat-widget {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                display: flex;
                flex-direction: column;
                height: 100%;
                background: #fff;
                border-radius: 12px;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            }
    
            .chat-messages {
                flex: 1;
                overflow-y: auto;
                max-height: unset;
                padding: 20px;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }
    
            .message {
                max-width: 80%;
                padding: 12px 16px;
                border-radius: 18px;
                margin-bottom: 4px;
                word-wrap: break-word;
            }
    
            .user-message {
                background: #007AFF;
                color: white;
                align-self: flex-end;
                border-bottom-right-radius: 4px;
            }
    
            .response-message {
                background: #E9E9EB;
                color: black;
                align-self: flex-start;
                border-bottom-left-radius: 4px;
            }
    
            .chat-input-container {
                padding: 16px;
                border-top: 1px solid #E9E9EB;
                display: flex;
                gap: 12px;
            }
    
            .chat-input {
                flex: 1;
                padding: 12px;
                border: 1px solid #E9E9EB;
                border-radius: 24px;
                font-size: 14px;
                outline: none;
                transition: border-color 0.2s;
            }
    
            .chat-input:focus {
                border-color: #007AFF;
            }
    
            .send-button {
                background: #007AFF;
                color: white;
                border: none;
                border-radius: 24px;
                padding: 0 20px;
                font-size: 14px;
                cursor: pointer;
                transition: background-color 0.2s;
            }
    
            .send-button:hover {
                background: #0056b3;
            }
    
            .send-button:disabled {
                background: #ccc;
                cursor: not-allowed;
            }
    
            .typing-indicator {
                display: flex;
                gap: 8px;
                padding: 12px 16px;
                background: #E9E9EB;
                border-radius: 18px;
                border-bottom-left-radius: 4px;
                align-self: flex-start;
                margin-bottom: 4px;
            }
    
            .typing-dot {
                width: 8px;
                height: 8px;
                background: #909090;
                border-radius: 50%;
                animation: typing-bounce 1.4s infinite ease-in-out;
            }
    
            .typing-dot:nth-child(1) { animation-delay: 0s; }
            .typing-dot:nth-child(2) { animation-delay: 0.2s; }
            .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    
            @keyframes typing-bounce {
                0%, 80%, 100% { transform: translateY(0); }
                40% { transform: translateY(-8px); }
            }
    
            .chat-widget-popup {
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 360px;
                height: 600px;
                display: none;
                z-index: 1000;
                background: #fff;
                border-radius: 12px;
                overflow: hidden;
            }
    
            .chat-widget-popup.active {
                display: block;
            }
    
            .chat-trigger-button {
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
                border-radius: 30px;
                background: #007AFF;
                color: white;
                border: none;
                cursor: pointer;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
                z-index: 999;
            }
    
            .chat-trigger-button:hover {
                background: #0056b3;
            }
    
            .chat-widget-popup .chat-messages {
                height: calc(100% - 120px); /* Adjusted for header + input heights */
                padding: 20px;
                padding-bottom: 100px; /* Increased bottom padding to prevent content from being hidden */
                overflow-y: auto;
            }
    
            .chat-widget-popup .chat-input-container {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background: #fff;
                border-top: 1px solid #E9E9EB;
                padding: 16px;
                display: flex;
                gap: 12px;
            }
    
            .chat-header {
                padding: 16px;
                border-bottom: 1px solid #E9E9EB;
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: #fff;
            }
    
            .chat-title {
                font-weight: 600;
                font-size: 16px;
                color: #333;
            }
    
            .close-button {
                background: none;
                border: none;
                font-size: 20px;
                cursor: pointer;
                color: #666;
                padding: 4px 8px;
                border-radius: 4px;
                transition: background-color 0.2s;
            }
    
            .close-button:hover {
                background-color: #f0f0f0;
            }
    
            /* Adjust messages container to account for header */
            .chat-widget-popup .chat-messages {
                height: calc(100% - 170px); /* Adjusted for header + input heights */
                padding-bottom: 80px;
            }
        </style>

        <div style="position: absolute;">
            <div id="chat-widget" class="chat-widget">
                <div class="chat-header">
                    <div class="chat-title">SmartYacht Demo</div>
                    <button class="close-button" id="close-chat">√ó</button>
                </div>
                <div id="chat-messages" class="chat-messages"></div>
                <div class="chat-input-container">
                    <input type="text" id="chat-input" class="chat-input" placeholder="Type your message...">
                    <button id="send-button" class="send-button">Send</button>
                </div>
            </div>

            <button id="chat-trigger" class="chat-trigger-button">
                üí¨
            </button>
        </div>
        

    <script>
        class ChatWidget {
            constructor(endpoint, mode = 'inline') {
                this.endpoint = endpoint;
                this.mode = mode;
                this.messageContainer = document.getElementById('chat-messages');
                this.input = document.getElementById('chat-input');
                this.sendButton = document.getElementById('send-button');
                this.chatWidget = document.getElementById('chat-widget');
                this.chatTrigger = document.getElementById('chat-trigger');
                this.closeButton = document.getElementById('close-chat');
                this.threadId = null;
                
                this.setupMode();
                this.setupEventListeners();
            }

            setupMode() {
                if (this.mode === 'popup') {
                    this.chatWidget.classList.add('chat-widget-popup');
                    this.chatTrigger.style.display = 'block';
                } else {
                    this.chatWidget.classList.remove('chat-widget-popup');
                    this.chatTrigger.style.display = 'none';
                }
            }

            setupEventListeners() {
                this.sendButton.addEventListener('click', () => this.sendMessage());
                this.input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });

                this.input.addEventListener('input', () => {
                    this.sendButton.disabled = !this.input.value.trim();
                });

                if (this.mode === 'popup') {
                    this.chatTrigger.addEventListener('click', () => {
                        this.chatWidget.classList.toggle('active');
                    });

                    this.closeButton.addEventListener('click', () => {
                        this.chatWidget.classList.remove('active');
                    });
                }
            }

            addMessage(text, isUser) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'user-message' : 'response-message'}`;
                const htmlContent = isUser ? text : this.convertToHTML(text);
                messageDiv.innerHTML = htmlContent;
                this.messageContainer.appendChild(messageDiv);
                this.messageContainer.scrollTop = this.messageContainer.scrollHeight;
            }

            convertToHTML(response) {
                let htmlResponse = response.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
                htmlResponse = htmlResponse.replace(/(„Äê.*?„Äë)/g, "");
                htmlResponse = htmlResponse.replace(/###\s(.*?)(?:\n|$)/g, "<h3>$1</h3>");
                htmlResponse = htmlResponse.replace(/\n-\s/g, "\n<li>").replace(/\n/g, "<br>");
                if (htmlResponse.includes("<li>")) {
                    htmlResponse = htmlResponse.replace(/(<br><li>.*<\/li>)/g, "<ul>$1</ul>");
                }
                return htmlResponse;
            }

            showTypingIndicator() {
                const indicator = document.createElement('div');
                indicator.className = 'typing-indicator';
                indicator.innerHTML = `
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                `;
                indicator.id = 'typing-indicator';
                this.messageContainer.appendChild(indicator);
                this.messageContainer.scrollTop = this.messageContainer.scrollHeight;
            }

            removeTypingIndicator() {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }

            async sendMessage() {
                const message = this.input.value.trim();
                if (!message) return;

                this.sendButton.disabled = true;
                this.input.disabled = true;

                try {
                    this.addMessage(message, true);
                    this.showTypingIndicator();
                    
                    const payload = {
                        assistant_id: "asst_opdfETAEcAVSwshAZZdN8D14",
                        message
                    };

                    if (this.threadId) {
                        payload.thread_id = this.threadId;
                    }

                    const response = await fetch(this.endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload)
                    });

                    const data = await response.json();
                    this.removeTypingIndicator();
                    
                    if (data.thread_id) {
                        this.threadId = data.thread_id;
                    }
                    this.addMessage(data.response, false);
                } catch (error) {
                    this.removeTypingIndicator();
                    console.error('Error sending message:', error);
                    this.addMessage('Sorry, there was an error sending your message.', false);
                } finally {
                    this.input.value = '';
                    this.input.disabled = false;
                    this.sendButton.disabled = false;
                    this.input.focus();
                }
            }
        }

        const initChatWidget = (endpoint, mode = 'inline') => {
            return new ChatWidget(endpoint, mode);
        }

        const chat = initChatWidget('https://hook.us1.make.com/ouc69ww2ybwot4w9utreqbrxddc3dozv', 'popup');
    </script>
    <!-- End of Chat Widget -->
</div>
</body>
</html>
